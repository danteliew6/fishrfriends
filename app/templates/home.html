{% extends "base.html" %}
{% block title %} Home {% endblock %}
{%block content%} 

<style>
    p1 {text-align: center;
    }
    .containercenter {
    /* Make elements centered */
        display: flex;
        justify-content: center;
        margin-top: 100px;
    }   
    .cardshadow {
    /* Add shadows to create the "card" effect */
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
    transition: 0.3s;
    }

    /* On mouse-over, add a deeper shadow */
    .cardshadow:hover {
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
    }
    .card-img-top {
    width: 100%;
    height: 15vw;
    object-fit: cover;
    }   
</style>


<div>
    <h1 class="containercenter">Welcome to FISH R FRIENDS</h1>
</div>

<!-- If there is fish, will run page -->
{% if datacode == 200 %}

<div class="card-deck " style="margin-top: 80px;">
    {%for fish in fishes%}
    {% set name = 'images/' + fish['fishname'] + '.png' %}
    {% set countid = fish['fish_id'] %}
    
    <div class="card cardshadow border-light">
        <p hidden class="fishid">{{fish['fish_id']}}</p>
      <img class="card-img-top" src={{ url_for('static', filename = name) }} alt="Card image cap">
      <div class="card-body">
        <h5 class="card-title">{{fish['fishname']}}</h5>
        <p class="card-text">
            <span style="font-style: italic">{{fish['description']}} </span>
            </br>
            <p>
                <b>Price:$</b>
                <span class="price">{{fish.price}}</span>
            </p>
                <b>Stock:</b> {{fish['stock_qty']}}
            </br>

        </p>

        <div>
            <button type ="button" class="btn btn-dark btn-block" onclick="addItem('{{countid}}','{{fish.stock_qty}}')" >Add to cart</button>
        </div>
        </br> 
            <p style="text-align: center">Item in cart:
            <span class = "quantity" id= {{countid}} >0</span>
            </p>
      </div>
    </div>

    {% endfor%}

</div>

<!--{{price_array}}-->

<div style="margin-bottom: 40px; margin-top: 30px">
    <p style="text-align: right; font-size: 30px;">
        Total Price: $<span id = "result" >0</span>
    </p>
    </br>
    <button class="btn btn-dark btn-lg" style="float: right;" onclick="calculate()" >Calculate Total Price</button>
</div>
<div style="margin-bottom: 50px; margin-top: 50px; padding-top: 50px; padding-bottom:50px">
        <button class="btn btn-primary btn-lg" style="float: right;" onclick="checkout()" >Checkout</button>
</div>



{% else %}

<!--If no fish in database-->
<div class="containercenter">
        <img src="../static/images/outofstock.png">
</div>

<p class="containercenter" style="font-size:30px;">
    All our fishes are out of stock!
</p>
<p class="containercenter" style="font-size:20px;">
    Our fishermen have headed out to sea to catch more fish, please come back again at a later time!
</p>

{%endif%}

<script>

    function calculate(){

        let priceList = document.getElementsByClassName("price");
        let countList = document.getElementsByClassName("quantity");
        let fishList = document.getElementsByClassName("fishid");

        var total = 0;
        for( i = 0; i < priceList.length ; i++){
            total += parseInt(countList[i].innerHTML) * parseFloat(priceList[i].innerHTML);
        }
        document.getElementById('result').innerHTML = total;
    }

    function checkout(){
        let priceList = document.getElementsByClassName("price");
        let fishList = document.getElementsByClassName("fishid");
        let countList = document.getElementsByClassName("quantity");
        var obj = new Object();
        var string;
        var total = 0;
        for( i = 0; i < priceList.length ; i++){
            obj.fish_id = parseInt(fishList[i].innerHTML);
            obj.quantity = parseInt(countList[i].innerHTML);
            obj.price = parseInt(priceList[i].innerHTML);
            if (i==0) {
                string = JSON.stringify(obj);
            } else {
            string += JSON.stringify(obj);
            total += parseInt(countList[i].innerHTML) * parseFloat(priceList[i].innerHTML);
            }
        }
        let price = total;

        string = "{"+"\"price\": "+price+""+", \"orders\" : [" + string + "]}";
        
        //JSON string to send to checkout
        console.log(string);
        

        }
    //var button = document.getElementById('1'), count = 0 ;
    function addItem(x,y){
        count = document.getElementById(x).innerHTML;
        count = parseInt(count)
        if(count+1 <= parseInt(y)){
            count += 1;
        }
        document.getElementById(x).innerHTML=count;
    };


</script>



{% endblock %}